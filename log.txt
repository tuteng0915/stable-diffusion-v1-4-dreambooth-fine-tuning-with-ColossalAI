/root/miniconda3/lib/python3.8/site-packages/colossalai/initialize.py:48: UserWarning: `config` is deprecated and will be removed soon.
  warnings.warn("`config` is deprecated and will be removed soon.")
[04/10/24 21:44:56] INFO     colossalai - colossalai - INFO: /root/miniconda3/lib/python3.8/site-packages/colossalai/initialize.py:67 launch                                                                 
                    INFO     colossalai - colossalai - INFO: Distributed environment is initialized, world size: 1                                                                                           
                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:443 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: Loading tokenizer from pretrained model                                                                                                         
You are using a model of type clip_text_model to instantiate a model of type . This is not supported for all configurations of models and can yield errors.
                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:455 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: Loading text_encoder from ./model/stable-diffusion-v1-4                                                                                         
                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:463 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: Loading AutoencoderKL from ./model/stable-diffusion-v1-4                                                                                        
[04/10/24 21:44:57] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:471 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: Loading UNet2DConditionModel from ./model/stable-diffusion-v1-4                                                                                 
[extension] Compiling the JIT cpu_adam_x86 kernel during runtime now
[extension] Time taken to compile cpu_adam_x86 op: 1.4829273223876953 seconds
[extension] Compiling the JIT fused_optim_cuda kernel during runtime now
[extension] Time taken to compile fused_optim_cuda op: 1.3670978546142578 seconds
[04/10/24 21:45:10] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:513 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: Prepare dataset from ./instance                                                                                                                 
[04/10/24 21:45:12] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:593 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: ***** Running training *****                                                                                                                    
                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:594 main                                                                                                         
                    INFO     colossalai - colossalai - INFO:   Num examples = 4                                                                                                                              
                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:595 main                                                                                                         
                    INFO     colossalai - colossalai - INFO:   Num batches each epoch = 4                                                                                                                    
                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:596 main                                                                                                         
                    INFO     colossalai - colossalai - INFO:   Num Epochs = 5                                                                                                                                
                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:597 main                                                                                                         
                    INFO     colossalai - colossalai - INFO:   Instantaneous batch size per device = 1                                                                                                       
                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:598 main                                                                                                         
                    INFO     colossalai - colossalai - INFO:   Total train batch size (w. parallel, distributed & accumulation) = 1                                                                          
                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:599 main                                                                                                         
                    INFO     colossalai - colossalai - INFO:   Total optimization steps = 20                                                                                                                 
Steps:   0%|                                                                                                                                                                          | 0/20 [00:00<?, ?it/s][04/10/24 21:45:15] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 8660.18310546875 MB                                                                                                         
Steps:   5%|███████                                                                                                                                     | 1/20 [00:03<01:07,  3.55s/it, loss=0.0698, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.65673828125 MB                                                                                                        
Steps:  10%|██████████████                                                                                                                              | 2/20 [00:03<00:28,  1.58s/it, loss=0.0133, lr=1e-6][04/10/24 21:45:16] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  15%|█████████████████████▎                                                                                                                        | 3/20 [00:03<00:16,  1.06it/s, loss=0.04, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  20%|████████████████████████████▏                                                                                                                | 4/20 [00:04<00:10,  1.55it/s, loss=0.637, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  25%|███████████████████████████████████                                                                                                         | 5/20 [00:04<00:09,  1.63it/s, loss=0.0576, lr=1e-6][04/10/24 21:45:17] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  30%|█████████████████████████████████████████▋                                                                                                 | 6/20 [00:04<00:06,  2.15it/s, loss=0.00509, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  35%|█████████████████████████████████████████████████▎                                                                                           | 7/20 [00:05<00:04,  2.68it/s, loss=0.224, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  40%|████████████████████████████████████████████████████████                                                                                    | 8/20 [00:05<00:03,  3.18it/s, loss=0.0347, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  45%|██████████████████████████████████████████████████████████████▌                                                                            | 9/20 [00:05<00:03,  2.76it/s, loss=0.00486, lr=1e-6][04/10/24 21:45:18] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  50%|██████████████████████████████████████████████████████████████████████                                                                      | 10/20 [00:05<00:03,  3.24it/s, loss=0.933, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  55%|█████████████████████████████████████████████████████████████████████████████                                                               | 11/20 [00:06<00:02,  3.70it/s, loss=0.158, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  60%|████████████████████████████████████████████████████████████████████████████████████                                                        | 12/20 [00:06<00:01,  4.09it/s, loss=0.638, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  65%|███████████████████████████████████████████████████████████████████████████████████████████                                                 | 13/20 [00:06<00:02,  3.19it/s, loss=0.236, lr=1e-6][04/10/24 21:45:19] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  70%|██████████████████████████████████████████████████████████████████████████████████████████████████                                          | 14/20 [00:06<00:01,  3.65it/s, loss=0.922, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                   | 15/20 [00:07<00:01,  4.05it/s, loss=nan, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                            | 16/20 [00:07<00:00,  4.37it/s, loss=nan, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                     | 17/20 [00:07<00:00,  3.38it/s, loss=nan, lr=1e-6][04/10/24 21:45:20] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊              | 18/20 [00:07<00:00,  3.81it/s, loss=nan, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps:  95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉       | 19/20 [00:08<00:00,  4.19it/s, loss=nan, lr=1e-6]                    INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:668 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: max GPU_mem cost is 11662.49169921875 MB                                                                                                        
Steps: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:08<00:00,  4.53it/s, loss=nan, lr=1e-6][04/10/24 21:45:27] INFO     colossalai - colossalai - INFO: train_dreambooth_colossalai.py:705 main                                                                                                         
                    INFO     colossalai - colossalai - INFO: Saving model checkpoint to ./output on rank 0                                                                                                   
Steps: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:15<00:00,  1.29it/s, loss=nan, lr=1e-6]
Loading pipeline components...: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 6/6 [00:01<00:00,  3.20it/s]
You have disabled the safety checker for <class 'diffusers.pipelines.stable_diffusion.pipeline_stable_diffusion.StableDiffusionPipeline'> by passing `safety_checker=None`. Ensure that you abide to the conditions of the Stable Diffusion license and do not expose unfiltered results in services or applications open to the public. Both the diffusers team and Hugging Face strongly recommend to keep the safety filter enabled in all public facing circumstances, disabling it only for use-cases that involve analyzing network behavior or auditing its results. For more information, please have a look at https://github.com/huggingface/diffusers/pull/254 .
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  8.20it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  8.15it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  8.15it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  8.18it/s]
Loading pipeline components...: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 6/6 [00:00<00:00, 12.67it/s]
You have disabled the safety checker for <class 'diffusers.pipelines.stable_diffusion.pipeline_stable_diffusion.StableDiffusionPipeline'> by passing `safety_checker=None`. Ensure that you abide to the conditions of the Stable Diffusion license and do not expose unfiltered results in services or applications open to the public. Both the diffusers team and Hugging Face strongly recommend to keep the safety filter enabled in all public facing circumstances, disabling it only for use-cases that involve analyzing network behavior or auditing its results. For more information, please have a look at https://github.com/huggingface/diffusers/pull/254 .
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.70it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.69it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.67it/s]
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.67it/s]